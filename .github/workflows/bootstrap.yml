name: Bootstrap scaffold

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create directories and files (minimal)
        run: |
          set -e
          mkdir -p apps/api/src apps/api/prisma apps/web/src/pages packages/shared

          printf '%s\n' "# Real Estate Platform" "" "Monorepo scaffold for the Real Estate Transaction Management Platform." > README.md

          printf '%s\n' "node_modules" ".env" ".env.local" "/dist" "/.next" "/apps/api/node_modules" "/apps/web/node_modules" "/packages/*/node_modules" ".DS_Store" > .gitignore

          printf '%s\n' "NEXT_PUBLIC_API_URL=http://localhost:4000/api/v1" "" "# Backend" "PORT=4000" "NODE_ENV=development" > .env.example

          printf '%s\n' '{' '  "name": "real-estate-api",' '  "version": "0.1.0"' '}' > apps/api/package.json
          printf '%s\n' '{' '  "name": "real-estate-web",' '  "version": "0.1.0"' '}' > apps/web/package.json
          printf '%s\n' '{' '  "name": "@real-estate/shared",' '  "version": "0.1.0"' '}' > packages/shared/package.json

          # small example backend file
          printf '%s\n' "import express from 'express';" "const app = express();" "app.get('/api/v1/health', (_req, res) => res.json({ status: 'ok' }));" "app.listen(process.env.PORT || 4000);" > apps/api/src/index.ts

      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Commit and push scaffold
        run: |
          git add -A
          git commit -m "chore: bootstrap minimal scaffold" || echo "no changes to commit"
          git push origin HEAD:main || (echo "Push failed â€” likely branch protection or permissions; see Action log" && exit 0)

      - name: List created files
        run: |
          echo "Top-level files:"
          ls -la
          echo "apps/api/"
          ls -la apps/api || true
